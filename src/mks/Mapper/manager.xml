<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mks.Mapper.managerMapper">

	<select id="patientList" parameterType="map" resultType="map">
        SELECT MIN(mem.mem_name) mem_name , mem.mem_memcode mem_memcode, MIN(mem.mem_socialnum) mem_socialnum,MIN(mem.mem_phone) mem_phone
               FROM MKS_MEMBER mem , MKS_HISTORY his
           WHERE mem.mem_memcode = his.mem_memcode 
   		<if test="hp_code!=null">
	   		AND his.hp_code=#{hp_code}
   		</if>
   		GROUP BY mem.mem_memcode
   		ORDER BY mem.mem_memcode
	</select>
	<select id="patientSEL" parameterType="map" resultType="map">
        SELECT MIN(mem.mem_name) mem_name , mem.mem_memcode mem_memcode, MIN(mem.mem_socialnum) mem_socialnum,MIN(mem.mem_phone) mem_phone
               FROM MKS_MEMBER mem , MKS_HISTORY his
           WHERE mem.mem_memcode = his.mem_memcode 
   		<if test="hp_code!=null">
	   		AND his.hp_code=#{hp_code}
   		</if>
   		<if test="mem_name!=null">
	   		AND mem.mem_name=#{mem_name}
   		</if>
   		<if test="mem_socialnum!=null">
	   		AND mem.mem_socialnum LIKE '%'||#{mem_socialnum}||'%'
   		</if>
   		GROUP BY mem.mem_memcode
   		ORDER BY mem.mem_memcode
	</select>

	<select id="patientDetail" parameterType="map" resultType="map">
      SELECT mem.mem_name mem_name , mem.mem_memcode mem_memcode, mem.mem_socialnum
		 mem_socialnum,mem.mem_phone mem_phone , his.his_date his_date , HIS.HIS_CONTENT his_content , mem.mem_address mem_address
		 , HIS.DOC_NAME doc_name ,HIS.DEPT_NAME dept_name
		FROM MKS_MEMBER mem , MKS_HISTORY his
		WHERE mem.mem_memcode = his.mem_memcode 
		<if test="hp_code!=null">
			AND his.hp_code=#{hp_code}
		 </if>
		 <if test="mem_code!=null">
			 AND mem.mem_memcode=#{mem_code}
		 </if>
		 ORDER BY mem.mem_memcode
	</select>

	<select id="noticeSEL" parameterType="map" resultType="map">
		SELECT b.board_no, b.board_content, b.board_date, b.board_title, b.board_file, o.dept_name,b.mks_id
		 FROM mks_board b, mks_online o
		 WHERE b.mks_id = o.mks_id
		 <if test="board_no!=null">
		 	AND b.board_no=#{board_no}
		 </if>
	</select>
	
	<select id="getBoardNO">
        SELECT NVL((
                     SELECT /*+index_desc(mks_board XPK게시판)*/ board_no
                          FROM mks_board
                       WHERE rownum = 1
                 ),0)+1 board_no
           FROM dual
	</select>
	
	<update id="noticeUPD" parameterType="map">
		UPDATE mks_board SET board_title=#{board_title}, board_content=#{board_content}
		 WHERE board_no=#{board_no}
	</update>
	
	<delete id="noticeDEL" parameterType="map">
	
	</delete>
	<insert id="noticeINS" parameterType="map">
		INSERT INTO mks_board (board_type,board_no, board_content, board_date, board_title, board_file, mks_id)
 			VALUES (0,#{board_no}, #{board_content}, TO_CHAR(sysdate,'YYYY-MM-DD'), #{board_title}, #{board_file}, #{mks_id});
	</insert>
	
</mapper>
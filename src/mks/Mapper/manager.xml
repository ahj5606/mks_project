<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mks.Mapper.managerMapper">

	<select id="patientList" parameterType="map" resultType="map">
        SELECT MIN(mem.mem_name) mem_name , mem.mem_memcode mem_memcode, MIN(mem.mem_socialnum) mem_socialnum,MIN(mem.mem_phone) mem_phone
               FROM MKS_MEMBER mem , MKS_HISTORY his
           WHERE mem.mem_memcode = his.mem_memcode 
   		<if test="hp_code!=null">
	   		AND his.hp_code=#{hp_code}
   		</if>
   		GROUP BY mem.mem_memcode
   		ORDER BY mem.mem_memcode
	</select>
	<select id="patientSEL" parameterType="map" resultType="map">
        SELECT MIN(mem.mem_name) mem_name , mem.mem_memcode mem_memcode, MIN(mem.mem_socialnum) mem_socialnum,MIN(mem.mem_phone) mem_phone
               FROM MKS_MEMBER mem , MKS_HISTORY his
           WHERE mem.mem_memcode = his.mem_memcode 
   		<if test="hp_code!=null">
	   		AND his.hp_code=#{hp_code}
   		</if>
   		<if test="mem_name!=null">
	   		AND mem.mem_name=#{mem_name}
   		</if>
   		<if test="mem_socialnum!=null">
	   		AND mem.mem_socialnum LIKE '%'||#{mem_socialnum}||'%'
   		</if>
   		GROUP BY mem.mem_memcode
   		ORDER BY mem.mem_memcode
	</select>

	<select id="patientDetail" parameterType="map" resultType="map">
      SELECT mem.mem_name mem_name , mem.mem_memcode mem_memcode, mem.mem_socialnum
		 mem_socialnum,mem.mem_phone mem_phone , his.his_date his_date , HIS.HIS_CONTENT his_content , mem.mem_address mem_address
		 , HIS.DOC_NAME doc_name ,HIS.DEPT_NAME dept_name
		FROM MKS_MEMBER mem , MKS_HISTORY his
		WHERE mem.mem_memcode = his.mem_memcode 
		<if test="hp_code!=null">
			AND his.hp_code=#{hp_code}
		 </if>
		 <if test="mem_code!=null">
			 AND mem.mem_memcode=#{mem_code}
		 </if>
		 ORDER BY mem.mem_memcode
	</select>

	<select id="noticeSEL" parameterType="map" resultType="map">
		SELECT b.board_no, b.board_content, b.board_date, b.board_title, b.board_file, o.dept_name
		 FROM mks_board b, mks_online o
		 WHERE b.mks_id = o.mks_id
		 <if test="board_no!=null">
		 	AND b.board_no=#{board_no}
		 </if>
	</select>
	
	<update id="noticeUPD" parameterType="map">
	
	</update>
	
	<delete id="noticeDEL" parameterType="map">
	
	</delete>
	

	<select id="doctorSEL" parameterType="map" resultType="map">

	</select>
	<select id="doctorList" parameterType="map" resultType="map">

		
	</select>
	


	<select id="doctorSEL" parameterType="map" resultType="map">
		
	</select>
	
	<insert id="doctorINS" parameterType="map">
		INSERT INTO mks_doctor(doc_code,hp_code,dept_name,doc_name,doc_position
							,doc_education,doc_phone,doc_offday,doc_state
								) 
                     VALUES(
                              #{doc_code}
                             ,#{hp_code}
                             ,#{dept_name}
                             ,#{doc_name}
                             ,#{doc_position}                                                    
                             ,#{doc_education}                                                    
                             ,#{doc_phone}
                             ,#{doc_offday}
                             ,#{doc_state}
                            )
	</insert>
	
	<update id="doctorUPD" parameterType="map">
		UPDATE mks_doctor
		       set
		<if test="doc_code!=null">
		       doc_code = #{doc_code}
		</if>       
		<if test="hp_code!=null">		       
		      ,hp_code = #{hp_code}
		</if>      
		<if test="dept_name!=null">		       
		      ,dept_name = #{dept_name}
		</if>      
		<if test="doc_name!=null">		       
		      ,doc_name = #{doc_name}
		</if>		      
		<if test="doc_position!=null">		       
		      ,doc_position = #{doc_position}
		</if>   
		<if test="doc_education!=null">		       
		      ,doc_education = #{doc_education}
		</if>   
		<if test="doc_phone!=null">		       
		      ,doc_phone = #{doc_phone}
		</if>   
		<if test="doc_offday!=null">		       
		      ,doc_offday = #{doc_offday}
		</if>   
		<if test="doc_phone!=null">		       
		      ,doc_state = #{doc_state}
		</if>   
		<where>
			<if test="doc_code!=null">
		 		and doc_code = #{doc_code}	
			</if>
		</where>  
	</update>
	
	<delete id="doctorDEL">
		DELETE FROM mks_doctor WHERE doc_name=#{doc_name}
	</delete>
	
	
	


	<select id="patientDoctor" parameterType="map" resultType="map">
     SELECT DOC_CODE,DOC_NAME,DEPT_NAME,DEPT_CODE,HP_NAME
         FROM MKS_DOCTOR 
         WHERE HP_CODE=#{hp_code}
	</select>
	
	<select id="getMemCode" parameterType="map" resultType="int">
          SELECT  mem_memcode+1
        		 FROM mks_member where rownum=1 
        	 ORDER BY mem_memcode DESC
	</select>
	
	<delete id="patientDEL" parameterType="map">
		DELETE FROM mks_history
		WHERE hp_code = #{hp_code}
		AND mem_memcode=#{mem_code}
	</delete>
	
	<insert id="patientINS" parameterType="map">
		INSERT INTO MKS_MEMBER(MEM_MEMCODE,MEM_NAME,MEM_SOCIALNUM,MEM_PHONE,MEM_ADDRESS,MEM_ONLINE)
		VALUES(#{mem_code},#{mem_name},#{mem_socialnum},#{mem_phone},#{mem_address},0)
	</insert>
	
	<insert id="patientHIS" parameterType="map">
		INSERT INTO MKS_HISTORY(HIS_DATE,HIS_CONTENT,MEM_MEMCODE,DOC_CODE,DOC_NAME,HP_CODE,DEPT_NAME,DEPT_CODE,HP_NAME)
		VALUES(#{his_date},#{his_content},#{mem_code},#{doc_code},#{doc_name},#{hp_code},#{dept_name},#{dept_code},#{hp_name})		
	</insert>	

	
</mapper>
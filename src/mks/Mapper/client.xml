<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mks.Mapper.clientMapper">
<!-- crm_HospitalDao 부분 -->
	<select id="hospitalList" parameterType="map" resultType="map">
		SELECT
		    r,hp_name,hp_lat,hp_lng,hp_detail,hp_address,hp_open,hp_close,hp_phone,dept_name
		  FROM view_hospitalList
	</select>
	
<!-- crm_ReservationDao 부분 -->	
	<resultMap id="rmap1" type="java.util.Map"/>	
	<resultMap id="rmap2" type="java.util.Map"/>	
	<resultMap id="rmap3" type="java.util.Map"/>	
	<resultMap id="rmap4" type="java.util.Map"/>	
	<select id="proc_reservelist" parameterType="java.util.Map" statementType="CALLABLE">
		<if test="u_dept_name == null and u_doc_name == null">
			{call proc_reservelist_first (
	                                   #{res_list,jdbcType=CURSOR
			                                   , mode=OUT
			                                   , javaType=java.sql.ResultSet
			                                   , resultMap=rmap1}
	                                    ,#{u_hp_code, mode=IN, jdbcType=VARCHAR}
	                                    ,#{fnum, mode=IN, jdbcType=INTEGER}
	                                    ,#{enum, mode=IN, jdbcType=INTEGER}			
								   )}
		</if>
		<if test="u_dept_name == null and u_doc_name != null">
			{call proc_reservelist_second (
	                                   #{res_list,jdbcType=CURSOR
			                                   , mode=OUT
			                                   , javaType=java.sql.ResultSet
			                                   , resultMap=rmap2}
	                                    ,#{u_hp_code, mode=IN, jdbcType=VARCHAR}
	                                    ,#{u_doc_name, mode=IN, jdbcType=VARCHAR}
	                                    ,#{fnum, mode=IN, jdbcType=INTEGER}
	                                    ,#{enum, mode=IN, jdbcType=INTEGER}			
								   )}
		</if>
		<if test="u_dept_name != null and u_doc_name == null">									   
			{call proc_reservelist_third (
	                                   #{res_list,jdbcType=CURSOR
			                                   , mode=OUT
			                                   , javaType=java.sql.ResultSet
			                                   , resultMap=rmap3}
	                                    ,#{u_hp_code, mode=IN, jdbcType=VARCHAR}
	                                    ,#{u_dept_name, mode=IN, jdbcType=VARCHAR}
	                                    ,#{fnum, mode=IN, jdbcType=INTEGER}
	                                    ,#{enum, mode=IN, jdbcType=INTEGER}			
								   )}
		</if>
		<!--  -->
		<if test="u_dept_name != null and u_doc_name != null"> 
			{call proc_reservelist_fourth (
	                                   #{res_list,jdbcType=CURSOR
			                                   , mode=OUT
			                                   , javaType=java.sql.ResultSet
			                                   , resultMap=rmap4}
	                                    ,#{u_hp_code, mode=IN, jdbcType=VARCHAR}
	                                    ,#{u_dept_name, mode=IN, jdbcType=VARCHAR}
	                                    ,#{u_doc_name, mode=IN, jdbcType=VARCHAR}
	                                    ,#{fnum, mode=IN, jdbcType=INTEGER}
	                                    ,#{enum, mode=IN, jdbcType=INTEGER}			
								   )}
		 </if>
	</select>
	<select id="waitCheck" parameterType="map" resultType="map">
		SELECT 
		    dept_prewait, (dept_lastwait - dept_prewait)*2
		  FROM mks_dept
		  WHERE hp_code = #{hp_code}
		  AND dept_name = #{dept_name} 	
	</select>
	<select id="docSel" parameterType="map" resultType="map">
		SELECT 
		    doc_name, dept_name, doc_position, doc_education
		  FROM mks_doctor
		  WHERE doc_name = #{doc_name}
	</select>
	
<!-- crm_HealthDao 부분 -->
<!-- crm_LoginDao 부분 -->
	<select id="proc_mem_login" parameterType="map" statementType="CALLABLE">
		{call proc_mem_login (
			#{u_id, mode=IN, jdbcType=VARCHAR}
			,#{u_pw, mode=IN, jdbcType=VARCHAR}						
			,#{msg, mode=OUT, jdbcType=VARCHAR}						
			,#{msg_id, mode=OUT, jdbcType=VARCHAR}						
		)}
	</select>
	
<!-- crm_MypageDao 부분 -->	
	<select id="idCheck" parameterType="map" resultType="map">
	<!-- id중복 검사  -->
		SELECT
		    o.mks_id
		  FROM mks_online o, mks_member m
		  WHERE o.mem_memcode = m.mem_memcode
		  AND o.mks_id = #{mks_id}	
	</select>
	<select id="socialnumCheck" parameterType="map" resultType="map">
	<!-- 주민번호 중복검사 -->
		SELECT
		    m.mem_socialnum
		  FROM mks_online o, mks_member m
		  WHERE o.mem_memcode = m.mem_memcode
		  AND m.mem_socialnum = #{mem_socialnum}	
	</select>
	<select id="proc_mem_Add" parameterType="map" statementType="CALLABLE">
	<!-- 그냥 회원가입할 때. -->
		{call proc_mem_Add (
			#{u_id, mode=IN, jdbcType=VARCHAR}
			,#{u_pw, mode=IN, jdbcType=VARCHAR}
			,#{msg, mode=OUT, jdbcType=VARCHAR}
			,#{u_soc, mode=IN, jdbcType=VARCHAR}
			,#{u_addr, mode=IN, jdbcType=VARCHAR}
			,#{u_phone, mode=IN, jdbcType=VARCHAR}
			,#{u_name, mode=IN, jdbcType=VARCHAR}
			,#{u_email, mode=IN, jdbcType=VARCHAR}
		)}
	</select>
	
</mapper>